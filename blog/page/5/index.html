<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
  <meta charset="utf-8">
  <title>Rahul Nath</title>
  <meta name="author" content="Rahul Nath">

  
<meta name="description" content="Rahul Nath is a programmer, blogger, speaker and enjoys running. Blogs are usually technical or about life in general." />


<meta name="keywords" content=".NET, programming, rahul nath, rahul, C#" />

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://rahulpnath.com/blog/page/5">
  
<!-- Favicon -->
  <link href="/favicon.png" type="image/png" rel="icon">
  <link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png">
  <link rel="icon" type="image/png" href="/favicon-196x196.png" sizes="196x196">
  <link rel="icon" type="image/png" href="/favicon-160x160.png" sizes="160x160">
  <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
  <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
  <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="msapplication-TileImage" content="/mstile-144x144.png">
<!-- End Favicon -->
  <link href="http://feeds2.feedburner.com/rahulpnath" rel="alternate" title="Rahul Nath" type="application/atom+xml">

  <!-- Social media content metadata -->


<meta property="fb:admins" content="774780093" />
<meta property="og:title" content="Rahul Nath" />
<meta property="og:site_name" content="Rahul Nath" />
<meta property="og:url" content="http://rahulpnath.com/blog/page/5/" />
<meta property="og:description" content="Rahul Nath is a programmer, blogger, speaker and enjoys running. Blogs are usually technical or about life in general." />
<meta property="og:author" content="https://www.facebook.com/774780093" />



<meta property="twitter:card" content="summary_large_image" />
<meta property="twitter:site" content="rahulpnath" />
<meta property="twitter:url" content="http://rahulpnath.com/blog/page/5" />
<meta property="twitter:title" content="Rahul Nath" />
<meta property="twitter:description" content="Rahul Nath is a programmer, blogger, speaker and enjoys running. Blogs are usually technical or about life in general." />
<meta property="twitter:creator" content="rahulpnath" />



<script 
    src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"
    integrity="sha256-pXtSQrmprcTB74RsNlFHuJxHK5zXcPrOMx78uWU0ayU="
    crossorigin="anonymous">
</script>

<script nonce="anF1ZXJ5ZmFsbGJhY2s=">
    window.jQuery || 
    document.write('<script src="/javascripts/libs/jquery/jquery-2.0.3.min.js" crossorigin="anonymous" integrity="sha256-ruuHogwePywKZ7bI1vHGGs7ScbBLhkNUcSSeRjhSUko=">\x3C/script>')
</script>

<link 
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.2.0/css/bootstrap.min.css"
    integrity="sha256-tf1yN1B2PrtzH5Ih5BPn1k1Y1RktwEDkIpLtPczMpzI="
    crossorigin="anonymous" />
<link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.2.0/css/bootstrap-theme.min.css"
    integrity="sha256-NLECy3aJQJ/Rw8GArrH9PwuL8LR6slx0xC6v9XTmYak="
    crossorigin="anonymous" />


  
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">

  
   <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-43172163-1', 'auto');
    ga('send', 'pageview');

  </script>


</head>

  <body   >
    <div id="wrap">
      <header role="banner">
        <nav class="navbar navbar-default" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Rahul Nath</a>
        </div>

        <div class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
                <li class="active">
                    <a rel="index" href="/">Blog</a>
                </li>
                <li >
                    <a href="/blog/archives">Archives</a>
                </li>
                <li >
                    <a href="/apps">Apps</a>
                </li>
                <li >
                    <a href="/about">About</a>
                </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a class="subscribe-rss" href="http://feeds2.feedburner.com/rahulpnath" title="subscribe via RSS">
                        <span class="visible-xs">RSS</span>
                        <img class="hidden-xs" src="/images/rss.png" alt="RSS">
                    </a>
                </li>
                
            </ul>
            
                <form class="search navbar-form navbar-right" action="http://google.com/cse" method="GET">
                    <input type="hidden" name="cx" value="013909293779229500224:v37rx6hsidk" />
                    <input name="ie" type="hidden" value="UTF-8">
                    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
                </form>
            
        </div>
    </div>
</nav>


      </header>
      <div id="main" class="container">
        <div id="content">
          <div class="row">
  <div class="page-content col-md-9">
    <div class="blog-index" itemscope itemtype="http://schema.org/Blog">
    <meta itemprop="name" content="Rahul Nath" />
    <meta itemprop="description" content="Rahul Nath is a programmer, blogger, speaker and enjoys running. Blogs are usually technical or about life in general." />
    <meta itemprop="url" content="http://rahulpnath.com" />
      
      
      
        <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
          
  <header class="page-header">
    
      <p class="meta text-muted text-capitalize">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2017-08-16T00:00:00+00:00"  data-updated="true" itemprop="datePublished dateCreated">Aug 16<sup>th</sup>, 2017</time>
        

<span class="glyphicon glyphicon-tags"></span>&nbsp; Posted in&nbsp; 
<span class="categories">
  
    <a class='category' href='/blog/category/programming/'>programming</a>
  
</span>


        
      </p>
    
    
      <h1 class="entry-title" itemprop="name headline"><a href="/blog/generating-a-large-pdf-from-website-contents-part-ii/" itemprop="url">Generating a Large PDF from Website Contents - HTML to PDF, Bookmarks and Handling Empty Pages</a></h1>
    
  </header>


  <div class="entry-content clearfix" itemprop="articleBody description"><p>In the previous post, <a href="/blog/generating-a-large-pdf-from-website-contents">Generating a Large PDF from Website Contents</a> we saw from a high level the approach taken to generate PDF files from a Content Management System (CMS) website. In this post, we will delve further into the details of each of those areas.</p>

<h3>HTML To PDF</h3>

<p>There are a lot of libraries and services that support converting HTML to PDF. We chose this mechanism mainly for keeping the content formatting simple and reusable. Most of the PDF data was to be structured like the website content. This means we can reuse (read copy/paste) the HTML styling for the PDF content as well.</p>

<p>We used <a href="https://www.essentialobjects.com/Products/EOPdf/Default.aspx">Essential Objects HTML to PDF Converter</a> library. Our website is hosted as an Azure Web App and the <a href="https://www.essentialobjects.com/doc/pdf/install/deploy.aspx">Essential Objects library does not work in the Azure sandbox environment</a>. The <a href="https://github.com/projectkudu/kudu/wiki/Azure-Web-App-sandbox#pdf-generation-from-html">Azure Sandbox restriction</a> affects most of the HTML to PDF libraries. The recommended approach to use those libraries is to host the PDF conversion logic on an Azure Virtual Machine, which is what we also ended up doing. Alternatively, you can choose to use one of the <a href="https://stackoverflow.com/questions/5344176/is-there-a-web-service-for-converting-html-to-pdf">HTML to PDF hosted services</a>.</p>

<p>The below code snippet is what you need to convert an HTML URL endpoint to PDF. It uses the HtmlToPdf class from the <a href="https://www.nuget.org/packages/EO.Pdf/">EO.Pdf Nuget package</a>. The HtmlToPdfOptions specifies various conversion and formatting options. You can set margin space, common headers, footers, etc. for the generated PDF content. It also provides extensibility points in the PDF conversion pipeline.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="n">FileContentResult</span> <span class="nf">Convert</span><span class="p">(</span><span class="kt">string</span> <span class="n">url</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="kt">var</span> <span class="n">pdfStream</span> <span class="p">=</span> <span class="k">new</span> <span class="n">MemoryStream</span><span class="p">();</span>
</span><span class='line'>    <span class="kt">var</span> <span class="n">pdfDocument</span> <span class="p">=</span> <span class="k">new</span> <span class="n">PdfDocument</span><span class="p">();</span>
</span><span class='line'>    <span class="kt">var</span> <span class="n">pdfOptions</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">GetPdfOptions</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>    <span class="kt">var</span> <span class="n">result</span> <span class="p">=</span> <span class="n">HtmlToPdf</span><span class="p">.</span><span class="n">ConvertUrl</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">pdfDocument</span><span class="p">,</span> <span class="n">pdfOptions</span><span class="p">);</span>
</span><span class='line'>    <span class="n">pdfDocument</span><span class="p">.</span><span class="n">Save</span><span class="p">(</span><span class="n">pdfStream</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="k">new</span> <span class="nf">FileContentResult</span><span class="p">(</span><span class="n">pdfStream</span><span class="p">.</span><span class="n">ToArray</span><span class="p">(),</span> <span class="s">&quot;application/pdf&quot;</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<blockquote><p><strong><em>HTML Formatting Tip</em></strong></p>

<p><em>You might want to avoid content being split across multiple pages. E.g., images, charts, etc. In this cases, you can use the <a href="https://css-tricks.com/almanac/properties/p/page-break/">page-break-*</a> CSS property to adjust page breaks. <a href="https://www.essentialobjects.com/doc/pdf/htmltopdf/paging.aspx">Essentials objects honors the page-break-*</a> settings and adjusts the content when converting into PDF.</em></p></blockquote>

<h3>Bookmarks</h3>

<p><em>A <a href="https://helpx.adobe.com/acrobat/using/page-thumbnails-bookmarks-pdfs.html#about_bookmarks">bookmark</a> is a type of link with representative text in the Bookmarks panel in the navigation pane. Each bookmark goes to a different view or page in the document. Bookmarks are generated automatically during PDF creation from the table-of-contents entries of a document.</em></p>

<p>We generate a lot of small PDF files (per section and category/sub-category) and then merge them together to form the larger PDF. Each of the sections has one or more entries towards Table Of Contents (TOC). We decided to generate bookmarks first per each generated PDF. When merging the individual PDF, the bookmarks are merged first, and then the TOC is created from the full bookmark tree.</p>

<p>Bookmarks can be created automatically or manually using Essential Objects library. Most of the other libraries also provide similar functionality. Using the <a href="https://www.essentialobjects.com/doc/EO.Pdf.HtmlToPdfOptions.AutoBookmark.html">AutoBookmark property</a> we can have bookmarks created automatically based on HTML header (H1-H6) elements. If this does not fit with your scenario, then you can create them manually. In our case, we insert hidden HTML tags to specify bookmarks. Bookmark hierarchy is represented using custom attributes as shown below.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">&quot;bookmark&quot;</span> <span class="na">id=</span><span class="s">&quot;TOC_Category1&quot;</span> <span class="na">name=</span><span class="s">&quot;Category1&quot;</span><span class="nt">&gt;</span>Category 1<span class="nt">&lt;/a&gt;</span>
</span><span class='line'>...
</span><span class='line'><span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">&quot;bookmark&quot;</span> <span class="na">id=</span><span class="s">&quot;TOC_Category1_Section1&quot;</span> <span class="na">name=</span><span class="s">&quot;Section1&quot;</span> <span class="na">tocParent=</span><span class="s">&quot;TOC_Category1&quot;</span><span class="nt">&gt;</span>Section 1<span class="nt">&lt;/a&gt;</span>
</span><span class='line'>...
</span><span class='line'><span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">&quot;bookmark&quot;</span> <span class="na">id=</span><span class="s">&quot;TOC_Category1_Section2&quot;</span> <span class="na">name=</span><span class="s">&quot;Section2&quot;</span> <span class="na">tocParent=</span><span class="s">&quot;TOC_Category1&quot;</span><span class="nt">&gt;</span>Section 2<span class="nt">&lt;/a&gt;</span>
</span><span class='line'>...
</span></code></pre></td></tr></table></div></figure>


<p>Once the PDF is created from the URL, we parse the HTML content for elements with <em>bookmark</em> class and manually add the bookmarks into the generated PDF. The <em><a href="https://www.essentialobjects.com/doc/EO.Pdf.HtmlDocument.GetElementsByClassName_overload_1.html">GetElementsByClassName</a></em> and the <em><a href="https://www.essentialobjects.com/doc/EO.Pdf.HtmlElement.CreateBookmark_overloads.html">CreateBookmark</a></em> methods help us to create bookmarks from the hidden HTML elements in the page.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="p">{</span>
</span><span class='line'> <span class="p">...</span>
</span><span class='line'> <span class="kt">var</span> <span class="n">result</span> <span class="p">=</span> <span class="n">HtmlToPdf</span><span class="p">.</span><span class="n">ConvertUrl</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">pdfDocument</span><span class="p">,</span> <span class="n">pdfOptions</span><span class="p">);</span>
</span><span class='line'> <span class="n">BuildBookmarkTree</span><span class="p">(</span><span class="n">pdfDocument</span><span class="p">,</span> <span class="n">result</span><span class="p">);</span>
</span><span class='line'> <span class="n">pdfDocument</span><span class="p">.</span><span class="n">Save</span><span class="p">(</span><span class="n">pdfStream</span><span class="p">);</span>
</span><span class='line'> <span class="p">...</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">private</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">BuildBookmarkTree</span><span class="p">(</span><span class="n">PdfDocument</span> <span class="n">pdfDocument</span><span class="p">,</span> <span class="n">HtmlToPdfResult</span> <span class="n">htmlToPdfResult</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="kt">var</span> <span class="n">bookmarkElements</span> <span class="p">=</span> <span class="n">htmlToPdfResult</span><span class="p">.</span><span class="n">HtmlDocument</span><span class="p">.</span><span class="n">GetElementsByClassName</span><span class="p">(</span><span class="s">&quot;bookmark&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">htmlElement</span> <span class="k">in</span> <span class="n">bookmarkElements</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="kt">var</span> <span class="n">bookmark</span> <span class="p">=</span> <span class="n">htmlElement</span><span class="p">.</span><span class="n">CreateBookmark</span><span class="p">();</span>
</span><span class='line'>        <span class="p">...</span> <span class="c1">// Custom logic to build the bookmark hierarchy</span>
</span><span class='line'>        <span class="c1">// based on custom attributes or whatever approach you choose.</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">pdfDocument</span><span class="p">.</span><span class="n">Bookmarks</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">bookmark</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Handling Empty Pages</h3>

<p>In our case, the content is from a CMS, and the user gets an option to select what categories/sub-categories and sections of data to be displayed in the generated PDF. At times it happens that some of the selected combinations might not have any data in the system. To avoid printing a blank page (or an error page) in the generated PDF, we can check the conversion result to check for the returned content. Whenever the content does not exists the HTML endpoint returns an <a href="https://msdn.microsoft.com/en-us/library/system.web.mvc.emptyresult(v=vs.118">EmptyResult class</a>.aspx). At the PDF conversion side, you can check if the response is empty and accordingly perform your logic to ignore the generated PDF.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="k">static</span> <span class="k">class</span> <span class="nc">HtmlToPdfResultExtensions</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">static</span> <span class="kt">bool</span> <span class="nf">IsEmptyResponse</span><span class="p">(</span><span class="k">this</span> <span class="n">HtmlToPdfResult</span> <span class="n">htmlToPdfResult</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">htmlToPdfResult</span> <span class="p">!=</span> <span class="k">null</span> <span class="p">&amp;&amp;</span>
</span><span class='line'>            <span class="n">htmlToPdfResult</span><span class="p">.</span><span class="n">HtmlDocument</span> <span class="p">!=</span> <span class="k">null</span> <span class="p">&amp;&amp;</span>
</span><span class='line'>            <span class="n">htmlToPdfResult</span><span class="p">.</span><span class="n">HtmlDocument</span><span class="p">.</span><span class="n">Body</span> <span class="p">!=</span> <span class="k">null</span> <span class="p">&amp;&amp;</span>
</span><span class='line'>            <span class="kt">string</span><span class="p">.</span><span class="n">IsNullOrEmpty</span><span class="p">(</span><span class="n">htmlToPdfResult</span><span class="p">.</span><span class="n">HtmlDocument</span><span class="p">.</span><span class="n">Body</span><span class="p">.</span><span class="n">InnerText</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Once the individual PDF files are created for each of the section and category/subcategory combination, we can merge them together to generate the full PDF. We will see in the next post how to merge the bookmarks together along with shifting the PDF pages and generating Table of Contents from the bookmarks.</p>
</div>
  
  


        </article>
      
      
        <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
          
  <header class="page-header">
    
      <p class="meta text-muted text-capitalize">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2017-08-11T00:00:00+00:00"  data-updated="true" itemprop="datePublished dateCreated">Aug 11<sup>th</sup>, 2017</time>
        

<span class="glyphicon glyphicon-tags"></span>&nbsp; Posted in&nbsp; 
<span class="categories">
  
    <a class='category' href='/blog/category/tipow/'>tipow</a>, <a class='category' href='/blog/category/tools/'>tools</a>
  
</span>


        
      </p>
    
    
      <h1 class="entry-title" itemprop="name headline"><a href="/blog/analyze-your-site-performance/" itemprop="url">Tip of the Week: Analyze Your Site Performance</a></h1>
    
  </header>


  <div class="entry-content clearfix" itemprop="articleBody description"><p>If you own a website, then it is good to check their performance now and then. Various factors affect the site speed, and it&rsquo;s better to use some tools to do the job for you.</p>

<p><a href="https://developers.google.com/speed/pagespeed/">Google PageSpeed</a> is a set of tools from Google designed to check and optimize websites performance. PageSpeed Insights is one of the tools in the suite that helps identify the ways to make your site faster and mobile friendly. The tools check for common good practices and provide a score out of 100 points. <em>PageSpeed Insights only considers the network-independent aspects of page performance: the server configuration, the HTML structure of a page, and its use of external resources such as images, JavaScript, and CSS.</em></p>

<p><img src="/images/PageInsights.png" alt="PageInsights" class="center" ></p>

<p><a href="http://yslow.org/">YSlow</a> is a similar tool from Yahoo!, that analyzes web pages for performance. It is available as a browser extension and has one for all popular ones. It provides a grade for the web page based on a predefined ruleset or a user-defined ruleset. The grade is calculated based on the <a href="http://yslow.org/ruleset-matrix/">YSlow Ruleset Matrix</a>.</p>

<p><img src="/images/yslow.png" alt="YSlow" class="center" ></p>

<p>I have been implementing some of the recommendations from the above tools on this blog, but as you can see from the above results, there is still more to be done. Hope you find this helpful for your sites.</p>
</div>
  
  


        </article>
      
      
        <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
          
  <header class="page-header">
    
      <p class="meta text-muted text-capitalize">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2017-08-08T00:00:00+00:00"  data-updated="true" itemprop="datePublished dateCreated">Aug 8<sup>th</sup>, 2017</time>
        

<span class="glyphicon glyphicon-tags"></span>&nbsp; Posted in&nbsp; 
<span class="categories">
  
    <a class='category' href='/blog/category/design/'>design</a>, <a class='category' href='/blog/category/programming/'>programming</a>
  
</span>


        
      </p>
    
    
      <h1 class="entry-title" itemprop="name headline"><a href="/blog/generating-a-large-pdf-from-website-contents/" itemprop="url">Generating a Large PDF from Website Contents</a></h1>
    
  </header>


  <div class="entry-content clearfix" itemprop="articleBody description"><p>At one of my recent clients, we had a requirement to generate a PDF dynamically based on the contents of the website. The website is a Content Management System (CMS) built on top of <a href="https://umbraco.com/">Umbraco</a>. The content is grouped into different categories and sub-categories. Each category and sub-category had different sections/sub-sections under that. Some sections are optional for certain categories, and all of these are dynamic. In this post, I will walk through at high level the approach taken to solve the problem.</p>

<p>The user selects the categories/sub-categories and the sections that they wish to export as PDF. On submit, a PDF needs to be generated based on the website content.</p>

<figure class='code'><figcaption><span>Model Structure of Domain</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">Category</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">public</span> <span class="kt">string</span> <span class="n">Name</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>    <span class="k">public</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Section</span><span class="p">&gt;</span> <span class="n">Sections</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>    <span class="k">public</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Category</span><span class="p">&gt;</span> <span class="n">SubCategory</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">Section</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">public</span> <span class="kt">string</span> <span class="n">Name</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>    <span class="k">public</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Section</span><span class="p">&gt;</span> <span class="n">SubSections</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="/images/pdf_generation.png" class="center" alt="Select options to download" /></p>

<p>The actual site had one more level of options (say sub-sections), so you can imagine the number of possible combinations to generate the content. The site content was huge as well, and a PDF with all options selected would be around 4000-5000 pages. So creating the PDF every time some one clicks the button was out of the question. We had to cache the generated PDF&rsquo;s and serve them as the request comes in. But the challenge was how to manage the cache so that we can build up the PDF based on the options selected.</p>

<div class="alert alert-info">
If you are using HTML to PDF libraries be aware that most of the libraries out there (<a href="https://www.essentialobjects.com/Products/EOPdf/Default.aspx">Essential Object</a>, <a href="http://www.evopdf.com/">EvoPDF</a> etc.) <strong>does not work on Azure Web Apps</strong>. This is because of the <a href="https://github.com/projectkudu/kudu/wiki/Azure-Web-App-sandbox#pdf-generation-from-html">sandbox restrictions</a> on the applications irrespective of the Azure plan you are on. The preferred solution is to host the conversion code on a VM. If you find that an overhead (which it is) consider using the SAAS alternatives for converting HTML to PDF.
</div>


<p>Below is the flow diagram of the complete process of generating the PDF as a request comes. The request specifies the categories/sub-categories along with the sections that need to be in the generated PDF.</p>

<p><img src="/images/pdf_generation_flow.png" class="center" alt="PDF Generation Flow" /></p>

<p>We decided to create a PDF file for each section per category/subcategory selection. Once all the sections are ready, all the PDF files will be merged into one. While merging we also build up the bookmark tree and the table of contents. Inserting the table of contents page at the start of the PDF requires pushing all the page numbers to match the new ones.</p>

<p>The PDF layout for individual sections per category/subcategory is in HTML. The application exposes endpoints for the HTML content for the different sections. We used <a href="https://www.essentialobjects.com/Products/EOPdf/Default.aspx">Essential Object HTML to PDF Converter</a> to convert the HTML to PDF files. Bookmarks for the associated section are embedded in HTML. While converting to PDF, the bookmarks get added to the PDF, which later gets merged into the full bookmark tree. The generated PDF file is cached for any new requests.</p>

<p>Since we have around forty categories/sub-categories, twelve section, and ten sub-sections, generating the full PDF take a while. So we generate the cache at fixed intervals and as required (when content is updated in the CMS). The above approach of generating PDF files has been working fine for us. Since the individual PDF sections are generated in isolation, it gives us the flexibility to scale the generation process as required. Combining the generated PDF files is often fast and can be cached at a different level as well to speed up the whole process.</p>
</div>
  
  


        </article>
      
      
        <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
          
  <header class="page-header">
    
      <p class="meta text-muted text-capitalize">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2017-08-04T00:00:00+00:00"  data-updated="true" itemprop="datePublished dateCreated">Aug 4<sup>th</sup>, 2017</time>
        

<span class="glyphicon glyphicon-tags"></span>&nbsp; Posted in&nbsp; 
<span class="categories">
  
    <a class='category' href='/blog/category/productivity/'>productivity</a>, <a class='category' href='/blog/category/tipow/'>tipow</a>
  
</span>


        
      </p>
    
    
      <h1 class="entry-title" itemprop="name headline"><a href="/blog/chocolatey-install-softwares-with-ease/" itemprop="url">Tip of the Week: Chocolatey - Install Softwares With Ease</a></h1>
    
  </header>


  <div class="entry-content clearfix" itemprop="articleBody description"><p><img src="/images/chocolatey.png" alt="Chocolatey - Package Manager for Windows" class="center" ></p>

<p><a href="https://chocolatey.org/">Chocolatey</a> is a package manager for Windows. Chocolatey is a central store of applications, tools, and other packages. It allows you to install them on your computer from the command line. Let’s look at an example to make things more clear. Let’s say I want to install the Google Chrome Browser on my system. Below is how I would go about installing it.</p>

<blockquote><p><strong>Installing Google Chrome (Without Chocolatey)</strong></p>

<ol>
<li>Bing for Google Chrome (Assuming that you are on Windows and open up Internet Explorer and search for Google Chrome)</li>
<li>Click the relevant link from the Search Results</li>
<li>Hit the Download Chrome button</li>
<li>Wait for the installer to download and open that to install.</li>
</ol>


<p><strong>Installing Google Chrome (With Chocolatey)</strong></p>

<ol>
<li>Run &lsquo;<em>choco install googlechrome</em>&rsquo; from command line</li>
</ol>
</blockquote>

<p>Installing with Chocolatey is quick and easy. You no longer need to go around searching the web for the software that you want to install. If you are unsure of the package name (e.g. googlechrome), you can search the entire packages library. This is possible from the command line using &lsquo;<em>choco search</em>.&rsquo; Or you can also search on their <a href="https://chocolatey.org/packages">website</a>.</p>

<p>Run the below script from the command line to <a href="https://chocolatey.org/install">install Chocolatey Package Manager</a>. Once installed you can start managing applications through the command line using Chocolatey.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>@<span class="s2">&quot;%SystemRoot%\System32\WindowsPowerShell\v1.0\powershell.exe&quot;</span> -NoProfile -ExecutionPolicy Bypass -Command <span class="s2">&quot;iex ((New-Object System.Net.WebClient).DownloadString(&#39;https://chocolatey.org/install.ps1&#39;))&quot;</span> <span class="o">&amp;&amp;</span> SET <span class="s2">&quot;PATH=%PATH%;%ALLUSERSPROFILE%\chocolatey\bin&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Other than installing and searching packages, Chocolatey also supports a lot of other commands to manage applications including un-installation. The entire commands supported are available <a href="https://chocolatey.org/docs/commandslist">here</a>. Instead, you can get the details in your command line using &lsquo;<em>choco -h</em>.&rsquo;</p>

<p>Hope that helps you save some time when you next want to install something.</p>
</div>
  
  


        </article>
      
      
        <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
          
  <header class="page-header">
    
      <p class="meta text-muted text-capitalize">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2017-08-03T00:00:00+00:00"  data-updated="true" itemprop="datePublished dateCreated">Aug 3<sup>rd</sup>, 2017</time>
        

<span class="glyphicon glyphicon-tags"></span>&nbsp; Posted in&nbsp; 
<span class="categories">
  
    <a class='category' href='/blog/category/travelogue/'>travelogue</a>
  
</span>


        
      </p>
    
    
      <h1 class="entry-title" itemprop="name headline"><a href="/blog/one-day-trips-around-sydney/" itemprop="url">One Day Trips Around Sydney</a></h1>
    
  </header>


  <div class="entry-content clearfix" itemprop="articleBody description"><p>Australia is known for its beaches, and there are a plenty of them all around. Sydney is no different for that, and it&rsquo;s known for some of the world famous beaches including the Bondi beach. But at times it&rsquo;s also good to try places other than beaches. Here is a list of such places around Sydney that is perfect for a day trip and not just limited to beaches.</p>

<blockquote><p><a href="https://en.wikipedia.org/wiki/Wikipedia:Too_long;_didn%27t_read"><strong>TLDR;</strong></a></p>

<ul>
<li><a href="http://www.grandpacificdrive.com.au/">Grand Pacific Drive</a></li>
<li><a href="http://www.visitnsw.com/destinations/country-nsw/southern-highlands/fitzroy-falls/attractions">Fitzroy Falls</a></li>
<li><a href="http://visitkangaroovalley.com.au/">Kangaroo Valley</a></li>
<li><a href="http://www.audleyboatshed.com/">Audley Boating</a></li>
<li><a href="https://goo.gl/maps/r9Wup35pVFR2">Morriset Park</a></li>
<li><a href="http://www.watkinsfamilyfarm.com.au/">Mandarin Picking</a></li>
<li><a href="http://www.calmsleyhill.com.au/">Animal Farm (Kids)</a></li>
<li><a href="https://taronga.org.au/taronga-zoo">Taronga Zoo</a></li>
<li><a href="http://www.illawarrafly.com/">Illawarra Fly Treetops</a></li>
<li><a href="http://www.nantien.org.au/en/">Nan tien temple</a></li>
<li><a href="http://www.nationalparks.nsw.gov.au/visit-a-park/parks/kuringgai-chase-national-park">Ku-ring-gai Chase National Park</a></li>
<li><a href="http://theentrance.org.au/">The Entrance, Central Coast</a></li>
</ul>
</blockquote>

<h3><a href="http://www.grandpacificdrive.com.au/">Grand Pacific Drive</a></h3>

<p>The Grand Pacific Drive makes a perfect day out with one of the best drives and perfect scenery along the route. It starts from Royal National Park through Wollongong, Shellharbour, Kiama, Shoalhaven, Southern Highlands, Eurobodalla and ending at Sapphire Coast. Each one of those places have things enough to spend a whole day. You can either choose to do the entire drive or do each of these places on separate day trips.
The <a href="http://www.grandpacificdrive.com.au/">Grand Pacific Drive</a> site has all the details that you need to plan your trip. It also has a trip planner that makes planning easier.</p>

<p><a href="http://www.grandpacificdrive.com.au/">
    <img src="/images/sydney_trip_gpd.png" class="center" alt="Grand Pacific Drive" />
</a></p>

<p>Do make it one day for the <a href="https://www.instagram.com/p/BUoLoKYj2B3/?taken-by=rahulpnath">sun rise at the Sea Cliff bridge</a>. It&rsquo;s amazing and worth waking up early enough to make it up there on time.</p>

<h3><a href="http://www.visitnsw.com/destinations/country-nsw/southern-highlands/fitzroy-falls/attractions">Fitzroy Falls</a></h3>

<p>As the name suggests, the Fitzroy Falls spots a magnificent waterfall with a nice walking track along the sides. There are various lookouts to the waterfall along the walking track. There is also a cycling track from the falls to Kangaroo Valley for those interested.</p>

<p><img src="/images/sydney_trip_fitzroy_falls.jpg" class="center" alt="Fitzroy Falls" /></p>

<h3><a href="http://visitkangaroovalley.com.au/">Kangaroo Valley</a></h3>

<p>Kangaroo Valley is a two-hour drive from Sydney and is popular for kayaking, canoeing, golf and wine tasting. You can take a break and play on the banks of the Kangaroo River. Do check out the <a href="http://kangaroovalleyfudge.com.au/">Fudge House</a> if you have a sweet tooth and the <a href="http://worldsbestpies.com.au/">pie shop</a> for a quick snack.</p>

<h3><a href="http://www.audleyboatshed.com/">Audley Boating</a></h3>

<p>Situated in the Royal National Park, Audley boating provides a great experience along the Kangaroo Creek. You can hire a boat or ride a bike and enjoy the magnificent views.</p>

<h3><a href="https://goo.gl/maps/r9Wup35pVFR2">Morriset Park</a></h3>

<p>If you want to see Kangaroos, then this is the place you should be. You can get close up with kangaroos and hundreds of them. It&rsquo;s an experience that no zoo can provide. One of the Kangaroo spotting points is <a href="https://goo.gl/maps/r9Wup35pVFR2">near the Morriset Hospital</a>. Even on a rainy day, there were plenty of them so I am sure you would not miss out on it. There are a few other parks and places as well nearby where you can take a stroll and stand a chance of spotting one.</p>

<p><img src="/images/sydney_trip_morriset_park.png" class="center" alt="Morriset Park, Kangaroos" /></p>

<h3><a href="http://www.watkinsfamilyfarm.com.au/">Mandarin Picking</a></h3>

<p>Situated on the banks of Hawkesbury River at Wisemans Ferry there are a couple of farms where you can go picking mandarins. I had been to the <a href="http://www.watkinsfamilyfarm.com.au/">Watkins Family Farm</a> and enjoyed every bit of it. It&rsquo;s great fun for kids and equally for adults. We ended up going back there twice in the same season. Make sure you check the farm sites for details on timing and months they are open.</p>

<p>There are a few other picnic spots as well around the area. There is a <a href="http://www.rms.nsw.gov.au/roads/using-roads/vehicular-ferries/index.html#Wisemansferry">vehicle ferry service</a> to take your vehicle across the river and explore that side as well.</p>

<h3><a href="http://www.calmsleyhill.com.au/">Animal Farm (Kids)</a></h3>

<p>If you have kids, then a day out at one of the animal farms around Sydney is an excellent way to spend your day. Google should help you find the farms around you. The <a href="http://www.calmsleyhill.com.au/">Calmsley Hill</a> animal farm is a family friendly environment with <a href="http://www.calmsleyhill.com.au/visitor-information/daily-show-times">daily shows</a>, picnic and BBQ area. They often run some <a href="http://www.calmsleyhill.com.au/city-farm/web-deal">online offers</a> so make sure you check that out before you head off.</p>

<h3><a href="https://taronga.org.au/taronga-zoo">Taronga Zoo</a></h3>

<p>The zoo is always a great place to spend time. The <a href="https://taronga.org.au/taronga-zoo">Taronga Zoo</a> experience is no different. If you have not taken the Sydney Ferries before this is a good excuse to do that. It&rsquo;s really big, and there are a lot of shows as well. Do check out the show times prior and plan for it upfront. It can be crowded at times. If you have kids getting an annual pass to the zoo might be worth.</p>

<h3><a href="http://www.illawarrafly.com/">Illawarra Fly Treetops</a></h3>

<p>Escape into the trees at the <a href="http://www.illawarrafly.com/">Illawarra Fly Treetops</a> and enjoy the stunning views and the zipline experience. It is a perfect place for a day trip and equal fun for families. It offers a breath taking views and a great experience. Check out for <a href="https://illawarrafly.experienceoz.com.au/en/sydney/illawarra-fly-treetop-walk-online-ticketing">online offers</a>!</p>

<p><img src="/images/sydney_trip_illawara.png" class="center" alt="Illawara Fly Treetop" /></p>

<h3><a href="http://www.nantien.org.au/en/">Nan tien temple</a></h3>

<p>The Nan Tien Temple is the largest Buddhist temple in the Southern Hemisphere. It&rsquo;s a calm and peaceful place and a nice spot to take your day off and relax. The temple offers <a href="http://www.nantien.org.au/en/services">many services</a> including a guided tour. They run various retreats and meditation classes if you are interested. You can either choose to spend a whole day here or spend a few hours on the way to Illawarra Fly Tree Tops.</p>

<h3><a href="http://www.nationalparks.nsw.gov.au/visit-a-park/parks/kuringgai-chase-national-park">Ku-ring-gai Chase National Park</a></h3>

<p> Ku-ring-gai Chase National Park combines important history with scenic beauty, making it perfect for a day out for families and kids. There are great picnic areas, heritage walks, lighthouse, boating, etc. There are not many shops around so get all that you need on the way.</p>

<h3><a href="http://theentrance.org.au/">The Entrance, Central Coast</a></h3>

<p>Even though the main attraction here is a beach, there still are enough things other than that to make your trip worth while. Tuggerah Lakes Cycleway is an off-road, scenic 12-kilometre ride and is perfect to spend some time. Don&rsquo;t miss out on the <a href="https://goo.gl/maps/4cA463PzD3U2">Pelican Feeding</a> which happens at 3:30 pm every day all round the year.</p>

<p>These places make a perfect getaway for a day. Mix it up with some of the awesome beaches - Bondi, Palm, Wattamolla, La Perouse, Coogee, Ramsgate, Cronulla, etc. and it should be enough to keep all your weekends busy. What places did I miss? Sound off in the comments.</p>

<p>Have great weekends ahead!</p>
</div>
  
  


        </article>
      
      
        <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
          
  <header class="page-header">
    
      <p class="meta text-muted text-capitalize">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2017-07-26T00:00:00+00:00"  data-updated="true" itemprop="datePublished dateCreated">Jul 26<sup>th</sup>, 2017</time>
        

<span class="glyphicon glyphicon-tags"></span>&nbsp; Posted in&nbsp; 
<span class="categories">
  
    <a class='category' href='/blog/category/tipow/'>tipow</a>, <a class='category' href='/blog/category/web/'>web</a>
  
</span>


        
      </p>
    
    
      <h1 class="entry-title" itemprop="name headline"><a href="/blog/testing-your-website-under-different-bandwidths/" itemprop="url">Tip of the Week: Testing Your Website Under Different Bandwidths</a></h1>
    
  </header>


  <div class="entry-content clearfix" itemprop="articleBody description"><p>With the blazing fast internet speeds at work (and at home) it might be hard to imagine how sites would work for people with a lower bandwidth. When developing for the Web, it is good to keep in mind that people from various regions across the globe might access your site. Internet speeds are not that fast around the world. So it is essential to test how your website performs for people on a lower bandwidth.</p>

<p>There are a lot of plugins and external tools that can simulate a lower bandwidth scenario and makes testing on slower bandwidth easier. If you are using Google Chrome, then you already have one such tool under your belt. The <a href="https://developers.google.com/web/tools/chrome-devtools/network-performance/reference#throttling">Network tab</a> under Google Chrome Developer Tools has an option to set different bandwidth profiles. Setting this to a profile that you want, and launching the site forces the site load on the set bandwidth.</p>

<p><img src="/images/chrome_network_delay.png" alt="Google Chrome Developer Tools - Network Delay" class="center" /></p>

<p>There are many default bandwidth profiles in there, and it also allows you to add custom profiles if required. There is also an option to simulate offline mode, to test how the application behaves without an internet connection (if that applies to you). However such testing is mostly restricted to manual testing, and for automating this, you might have to look for external tools.</p>

<p>Hope this helps optimize your site for lower bandwidth!</p>
</div>
  
  


        </article>
      
      
        <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
          
  <header class="page-header">
    
      <p class="meta text-muted text-capitalize">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2017-07-24T00:00:00+00:00"  data-updated="true" itemprop="datePublished dateCreated">Jul 24<sup>th</sup>, 2017</time>
        

<span class="glyphicon glyphicon-tags"></span>&nbsp; Posted in&nbsp; 
<span class="categories">
  
    <a class='category' href='/blog/category/azure/'>azure</a>, <a class='category' href='/blog/category/programming/'>programming</a>
  
</span>


        
      </p>
    
    
      <h1 class="entry-title" itemprop="name headline"><a href="/blog/azure-web-restarting-automatically-due-to-overwhelming-change-notification/" itemprop="url">Azure Web App Restarting Automatically Due to Overwhelming Change Notification</a></h1>
    
  </header>


  <div class="entry-content clearfix" itemprop="articleBody description"><p>At one of my clients, we faced a strange issue recently. The Azure Web application restarted automatically very often. The event log in the <a href="https://github.com/projectkudu/kudu/wiki/Kudu-console">Kudu console</a> showed the below error message.</p>

<blockquote><p><em>2017-07-13 00:09:50,333 [P45516/D4/T171] INFO  Umbraco.Core.UmbracoApplicationBase - Application shutdown. Details: HostingEnvironment</em></p>

<p><em>_shutDownMessage=Directory rename change notification for &rsquo;D:\home\site\wwwroot&#8217;.</em>  <br/>
<em>Overwhelming Change Notification in wwwroot</em>   <br/>
<em>HostingEnvironment initiated shutdown</em>  <br/>
<em>Directory rename change notification for &rsquo;D:\home\site\wwwroot&#8217;.</em>   <br/>
<em>Overwhelming Change Notification in wwwroot</em>   <br/>
<em>Initialization Error</em>   <br/>
<em>HostingEnvironment caused shutdown</em></p></blockquote>

<p>As you can tell from the logs, the website is an <a href="https://umbraco.com/">Umbraco</a> CMS hosted as an Azure Web application. We noticed that the restarts were happening more when the content was getting updated through <a href="https://our.umbraco.org/documentation/getting-started/backoffice/">backoffice</a>. The error also states that the restart was caused due to <em>Overwhelming Change Notification in wwwroot</em>. This hints that there are changes that are happening under the wwwroot folder, where the site is hosted.</p>

<div class="alert alert-info">
Even though this post details on why the specific site on Umbraco was restarting, most of the contents are still applicable for any other ASP.NET MVC application.
</div>


<h3>fcnMode Configuration</h3>

<p>A quick search got me to the <a href="https://msdn.microsoft.com/en-us/library/system.web.configuration.httpruntimesection.fcnmode(v=vs.110">fcnMode</a>.aspx)setting under <a href="https://msdn.microsoft.com/en-us/library/system.web.configuration.httpruntimesection(v=vs.110">httpRuntime</a>.aspx) section. An ASP.net application monitors certain files and folders under the wwwroot folder and will restart the application domain whenever it detects changes. This likely look looks the reason why the web site is restarting.</p>

<p>The <a href="https://msdn.microsoft.com/en-us/library/system.web.configuration.fcnmode(v=vs.110">fcnMode enumeration</a>.aspx) can take one of the four values below. For an Umbraco application this is by <a href="http://issues.umbraco.org/issue/U4-7712">default set to <em>Single</em></a>.</p>

<ul>
<li><strong>Default</strong>: For each subdirectory, the application creates an object that monitors the subdirectory. This is the default behavior.</li>
<li><strong>Disabled</strong>: File change notification is disabled.</li>
<li><strong>NotSet</strong>: File change notification is not set, so the application creates an object that monitors each subdirectory. This is the default behavior.</li>
<li><strong>Single</strong>: The application creates one object to monitor the main directory and uses this object to monitor each subdirectory.</li>
</ul>


<figure class='code'><figcaption><span>fcnMode set to Single for Umbraco application</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;system.web&gt;</span>
</span><span class='line'>    ...
</span><span class='line'>    <span class="nt">&lt;httpRuntime</span>
</span><span class='line'>        <span class="na">requestValidationMode=</span><span class="s">&quot;2.0&quot;</span>
</span><span class='line'>        <span class="na">enableVersionHeader=</span><span class="s">&quot;false&quot;</span>
</span><span class='line'>        <span class="na">targetFramework=</span><span class="s">&quot;4.5&quot;</span>
</span><span class='line'>        <span class="na">maxRequestLength=</span><span class="s">&quot;51200&quot;</span>
</span><span class='line'>        <span class="na">fcnMode=</span><span class="s">&quot;Single&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>    ...
</span><span class='line'><span class="nt">&lt;system.web&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<blockquote><p><em>FCNMode creates a monitor object with a buffer size of 4KB for each folder. When FCNMode is set to Single, a single monitor object is created with a buffer size of 64KB. When there are file changes, the buffer is filled with file change information. If the buffer gets overwhelmed with too many file change notifications an “Overwhelming File Change Notifications” error will occur and the app domain will recycle. The likelihood of the buffer getting overwhelmed is higher in an environment where you are using separate file server because the folder paths are much larger.</em></p>

<p>-<a href="http://www.dnnsoftware.com/community-blog/cid/154980/aspnet-file-change-notifications-and-dnn"> ASP.NET File Change Notifications and DNN</a></p></blockquote>

<p>You can read more about fcnMode setting and how it affects ASP.Net applications <a href="https://shazwazza.com/post/all-about-aspnet-file-change-notification-fcn/">here</a>.</p>

<h3>What&rsquo;s causing file changes?</h3>

<p>Default reaction when you come across such a setting or configuration value might be to turn that off and fcnMode does allow that as well - <em>Disabled</em>. But first, it is better that we understand what is causing file changes under the wwwroot folder and see if we can address that. The <a href="https://shazwazza.com/post/fcn-file-change-notification-viewer-for-aspnet/">FCN Viewer</a> helps visualize how many files and folders are being watched in as ASP.Net application.</p>

<p>In the Umbraco website, we are using a third party library <a href="http://imageprocessor.org/">ImageProcessor</a> that helps to process images dynamically. The ImageProcessor caches images and the <a href="http://imageprocessor.org/imageprocessor-web/configuration/#cacheconfig">cache location is configurable</a>. By default, it caches files under the App_Data/cache folder, which also happens to be one of the folders that the ASP.Net application monitors for changes. So anytime there are lots of files changing in the cache folder it causes the single monitor object monitoring the folders. This causes a buffer overflow and triggers an application restart due to <em>Overwhelming file change notifications</em>. However, ImageProcessor does allow moving the <a href="https://github.com/JimBobSquarePants/ImageProcessor/issues/518">cache folder outside of the wwwroot folder</a>. This causes the file not to be monitored and still work fine with the application. Since the <a href="https://twitter.com/Shazwazza/status/885770960321773568">library does not create the cache folder automatically</a>, we need to make sure that the folder specified in the config file exists.</p>

<p>Having moved the cache folder outside of the wwwroot, I no longer need to update the fcnMode setting and can leave it as intended. If you are facing application restarts as well due to overwhelming change notification in wwwroot see what is likely causing the file changes and then try and fix that instead of just setting the fcnMode to disabled.</p>

<p>Hope that helps fix your application restarting problem!</p>
</div>
  
  


        </article>
      
      
        <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
          
  <header class="page-header">
    
      <p class="meta text-muted text-capitalize">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2017-07-19T00:00:00+00:00"  data-updated="true" itemprop="datePublished dateCreated">Jul 19<sup>th</sup>, 2017</time>
        

<span class="glyphicon glyphicon-tags"></span>&nbsp; Posted in&nbsp; 
<span class="categories">
  
    <a class='category' href='/blog/category/tipow/'>tipow</a>
  
</span>


        
      </p>
    
    
      <h1 class="entry-title" itemprop="name headline"><a href="/blog/hemingway-editor/" itemprop="url">Tip of the Week: Hemingway Editor - Improve Your Writing</a></h1>
    
  </header>


  <div class="entry-content clearfix" itemprop="articleBody description"><blockquote><p><em>Writing is hard work. A clear sentence is no accident. Very few sentences come out right the first time, or even the third time. Remember this in moments of despair. If you find that writing is hard, it&rsquo;s because it is hard.</em></p>

<p>&ndash; William Zinsser, On Writing Well</p></blockquote>

<p>Editing is the hardest part of writing and one that I skip the most. I try hard not to skip editing, but often I end up being lazy to do the hard work. I try to cover this up with some tools to make it faster. It is hard for one tool to get it all right. So it&rsquo;s best if you have a range of tools under your belt to support you with writing.</p>

<p><a href="http://www.hemingwayapp.com/">The Hemingway Editor</a> highlights hard to read sentences, adverbs, complicated phrases, etc. The writing app uses different colors to highlight the various issues as shown below. The editor also shows a summary of the text including the reading time, total words, sentences etc. The app also shows a <a href="http://www.hemingwayapp.com/help.html">Readability Grade</a> using Automated Readability Index.</p>

<p><img src="/images/hemingway.png" alt="Hemingway Editor"></p>

<p>The Hemingway Editor is available for free on the web with lesser features. The web application does not let you save your work. You are always at risk of loosing the work if you are authoring on the site.</p>

<p>The <a href="http://www.hemingwayapp.com/desktop.html">Windows/Mac applications</a> supports a larger set of features but for a price. The desktop application works without an internet connection, allows publishing to Wordpress/Medium. It also supports to exporting to different formats (word, pdf, html, markdown etc.).</p>

<p>I use the Hemingway Editor (on the web) occasionally and find it useful at times. It&rsquo;s good to double check for any issues before publishing the post. Hope this helps you as well in your writing.</p>
</div>
  
  


        </article>
      
      
        <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
          
  <header class="page-header">
    
      <p class="meta text-muted text-capitalize">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2017-07-18T00:00:00+00:00"  data-updated="true" itemprop="datePublished dateCreated">Jul 18<sup>th</sup>, 2017</time>
        

<span class="glyphicon glyphicon-tags"></span>&nbsp; Posted in&nbsp; 
<span class="categories">
  
    <a class='category' href='/blog/category/azure-key-vault/'>azure key vault</a>
  
</span>


        
      </p>
    
    
      <h1 class="entry-title" itemprop="name headline"><a href="/blog/signing-a-pdf-file-using-azure-key-vault/" itemprop="url">Signing a PDF File Using Azure Key Vault</a></h1>
    
  </header>


  <div class="entry-content clearfix" itemprop="articleBody description"><p><em>How to sign a PDF using Azure Key Vault?</em> - This is one of the questions that I often get regarding Azure Key Vault. In this post, we will explore how to sign a PDF using a certificate in Azure Key Vault. Signing a PDF has various aspects to it which are covered in depth in the white paper - <a href="http://developers.itextpdf.com/books#digsig">Digital Signatures for PDF Documents</a>. We will be using the <a href="http://itextpdf.com/">iText library</a> to sign the PDF. iText is available as a <a href="https://www.nuget.org/packages/itext7/">Nuget package library</a>. The below image shows the elements that composes a digital signature on the left and actual contents on the right.</p>

<p><img src="/images/adobe_signature.png" alt="Digitally Signed PDF Contents" /></p>

<h3>Signing with a Local Certificate</h3>

<p>When the certificate (along with the private key) is available locally, signing the PDF is straightforward. You can load the certificate as an X509Certificate from the local certificate store using the <a href="https://stackoverflow.com/questions/11115511/how-to-find-certificate-by-its-thumbprint-in-c-sharp">thumbprint</a>. Make sure that the certificate is installed with the Exportable option as shown below.</p>

<p><img src="/images/certificate_exportable.png" alt="Exportable certificate" /></p>

<p>The <a href="http://itextsupport.com/apidocs/itext5/latest/com/itextpdf/text/pdf/security/PrivateKeySignature.html">PrivateKeySignature</a> is an implementation of IExteralSignature that can be used to sign the PDF when the private key is available. The below code signs the <em>Hello World.pdf</em> using the certificate from the local store and saves that as <em>Local Key.pdf</em>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">private</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">SignPdfWithLocalCertificate</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="kt">var</span> <span class="n">certificate</span> <span class="p">=</span> <span class="n">GetCertificateLocal</span><span class="p">();</span>
</span><span class='line'>    <span class="kt">var</span> <span class="n">privateKey</span> <span class="p">=</span> <span class="n">DotNetUtilities</span><span class="p">.</span><span class="n">GetKeyPair</span><span class="p">(</span><span class="n">certificate</span><span class="p">.</span><span class="n">PrivateKey</span><span class="p">).</span><span class="n">Private</span><span class="p">;</span>
</span><span class='line'>    <span class="kt">var</span> <span class="n">externalSignature</span> <span class="p">=</span> <span class="k">new</span> <span class="n">PrivateKeySignature</span><span class="p">(</span><span class="n">privateKey</span><span class="p">,</span> <span class="s">&quot;SHA-256&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="n">SignPdf</span><span class="p">(</span><span class="n">certificate</span><span class="p">,</span> <span class="n">externalSignature</span><span class="p">,</span> <span class="s">&quot;Local Key.pdf&quot;</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">private</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">SignPdf</span><span class="p">(</span><span class="n">X509Certificate2</span> <span class="n">certificate</span><span class="p">,</span> <span class="n">IExternalSignature</span> <span class="n">externalSignature</span><span class="p">,</span> <span class="kt">string</span> <span class="n">signedPdfName</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="kt">var</span> <span class="n">bCert</span> <span class="p">=</span> <span class="n">DotNetUtilities</span><span class="p">.</span><span class="n">FromX509Certificate</span><span class="p">(</span><span class="n">certificate</span><span class="p">);</span>
</span><span class='line'>    <span class="kt">var</span> <span class="n">chain</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Org</span><span class="p">.</span><span class="n">BouncyCastle</span><span class="p">.</span><span class="n">X509</span><span class="p">.</span><span class="n">X509Certificate</span><span class="p">[]</span> <span class="p">{</span> <span class="n">bCert</span> <span class="p">};</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">reader</span> <span class="p">=</span> <span class="k">new</span> <span class="n">PdfReader</span><span class="p">(</span><span class="s">&quot;Hello World.pdf&quot;</span><span class="p">))</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">stream</span> <span class="p">=</span> <span class="k">new</span> <span class="n">FileStream</span><span class="p">(</span><span class="n">signedPdfName</span><span class="p">,</span> <span class="n">FileMode</span><span class="p">.</span><span class="n">OpenOrCreate</span><span class="p">))</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="kt">var</span> <span class="n">signer</span> <span class="p">=</span> <span class="k">new</span> <span class="n">PdfSigner</span><span class="p">(</span><span class="n">reader</span><span class="p">,</span> <span class="n">stream</span><span class="p">,</span> <span class="k">false</span><span class="p">);</span>
</span><span class='line'>            <span class="n">signer</span><span class="p">.</span><span class="n">SignDetached</span><span class="p">(</span><span class="n">externalSignature</span><span class="p">,</span> <span class="n">chain</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="n">PdfSigner</span><span class="p">.</span><span class="n">CryptoStandard</span><span class="p">.</span><span class="n">CMS</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Certificates in Azure Key Vault</h3>

<p>You can <a href="http://www.rahulpnath.com/blog/manage-certificates-in-azure-key-vault/">manage certificates in Azure Key Vault</a> as a first class citizen. Azure Key Vault supports creating new or uploading existing certificates into the vault. Key Vault provides an option to specify whether the private portion of the certificate is exportable or not. Let us see how we can use the certificate from the vault in both these scenarios.</p>

<h4><strong>Exportable Certificate</strong></h4>

<p>To create a self-signed certificate in the vault use the below PowerShell script. In this case, the private key is exportable. Executing the below script adds a self-signed certificate into the vault.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='powershell'><span class='line'><span class="nv">$certificatepolicy</span> <span class="p">=</span> <span class="nb">New-AzureKeyVaultCertificatePolicy</span>   <span class="n">-SubjectName</span> <span class="s2">&quot;CN=www.rahulpnath.com&quot;</span>   <span class="n">-IssuerName</span> <span class="n">Self</span>   <span class="n">-ValidityInMonths</span> <span class="n">12</span>
</span><span class='line'><span class="nb">Add-AzureKeyVaultCertificate</span> <span class="n">-VaultName</span> <span class="s2">&quot;VaultFromCode&quot;</span> <span class="n">-Name</span> <span class="s2">&quot;TestCertificate&quot;</span> <span class="n">-CertificatePolicy</span> <span class="nv">$certificatepolicy</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="/images/keyvault_getazurekeyvaultcertificate.png" class="center" alt="Key Vault Certificate" /></p>

<p>Creating a certificate, in turn, creates three objects in the vault - Certificate, Key, and Secret. The certificate represents the certificate just created, the Key represents the private part of the certificate, and the Secret has the certificate in PFX format (just as if you had uploaded a <a href="http://www.rahulpnath.com/blog/pfx-certificate-in-azure-key-vault/">PFX as a Secret</a>). Since the certificate created above is exportable, the Secret contains the Private portion of the key as well. To recreate the certificate locally in memory, we use the below code</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="k">static</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">X509Certificate2</span><span class="p">&gt;</span> <span class="n">GetCertificateKeyVault</span><span class="p">(</span><span class="kt">string</span> <span class="n">secretIdentifier</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="kt">var</span> <span class="n">client</span> <span class="p">=</span> <span class="n">GetKeyVaultClient</span><span class="p">();</span>
</span><span class='line'>    <span class="kt">var</span> <span class="n">secret</span> <span class="p">=</span> <span class="k">await</span> <span class="n">client</span><span class="p">.</span><span class="n">GetSecretAsync</span><span class="p">(</span><span class="n">secretIdentifier</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="kt">var</span> <span class="n">certSecret</span> <span class="p">=</span> <span class="k">new</span> <span class="n">X509Certificate2</span><span class="p">(</span>
</span><span class='line'>        <span class="n">Convert</span><span class="p">.</span><span class="n">FromBase64String</span><span class="p">(</span><span class="n">secret</span><span class="p">.</span><span class="n">Value</span><span class="p">),</span>
</span><span class='line'>        <span class="kt">string</span><span class="p">.</span><span class="n">Empty</span><span class="p">,</span>
</span><span class='line'>        <span class="n">X509KeyStorageFlags</span><span class="p">.</span><span class="n">Exportable</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="n">certSecret</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The certificate is encoded as Base64String in the Secret. We create an in-memory representation of the certificate and mark it as <em>Exportable</em>. This certificate can be used the same way as the local certificate. Since the private key is part of it, the PrivateKeySignature can still be used to sign.</p>

<h4><strong>Non Exportable Certificate</strong></h4>

<p>To create a non-exportable certificate when creating the certificate use <a href="https://docs.microsoft.com/en-us/powershell/module/azurerm.keyvault/new-azurekeyvaultcertificatepolicy?view=azurermps-4.1.0"><em>KeyNotExportable</em> flag</a> flag as below.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='powershell'><span class='line'><span class="nv">$certificatepolicy</span> <span class="p">=</span> <span class="nb">New-AzureKeyVaultCertificatePolicy</span>   <span class="n">-SubjectName</span> <span class="s2">&quot;CN=www.rahulpnath.com&quot;</span>   <span class="n">-IssuerName</span> <span class="n">Self</span>   <span class="n">-ValidityInMonths</span> <span class="n">12</span> <span class="n">-KeyNotExportable</span>
</span><span class='line'><span class="nb">Add-AzureKeyVaultCertificate</span> <span class="n">-VaultName</span> <span class="s2">&quot;VaultFromCode&quot;</span> <span class="n">-Name</span> <span class="s2">&quot;TestCertificateNE&quot;</span> <span class="n">-CertificatePolicy</span> <span class="nv">$certificatepolicy</span>
</span></code></pre></td></tr></table></div></figure>


<p>Executing this creates three objects in the vault as above. But since we marked the secret as non-exportable, the Secret will not have the private part of the key. We can create an in-memory representation of the certificate, but we cannot use the PrivateKeySignature as the certificate does not have the private key. We need to use the Key created along with the certificate to <em>Sign</em> the PDF bytes. For this we need a custom implementation of <em>IExternalSignature</em> - KeyVaultSignature.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">KeyVaultSignature</span> <span class="p">:</span> <span class="n">IExternalSignature</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">private</span> <span class="n">KeyVaultClient</span> <span class="n">keyClient</span><span class="p">;</span>
</span><span class='line'>    <span class="k">private</span> <span class="kt">string</span> <span class="n">keyIdentifier</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">public</span> <span class="nf">KeyVaultSignature</span><span class="p">(</span><span class="n">KeyVaultClient</span> <span class="n">client</span><span class="p">,</span> <span class="kt">string</span> <span class="n">keyIdentifier</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="n">keyClient</span> <span class="p">=</span> <span class="n">client</span><span class="p">;</span>
</span><span class='line'>        <span class="k">this</span><span class="p">.</span><span class="n">keyIdentifier</span> <span class="p">=</span> <span class="n">keyIdentifier</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">public</span> <span class="kt">string</span> <span class="nf">GetEncryptionAlgorithm</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="s">&quot;RSA&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">public</span> <span class="kt">string</span> <span class="nf">GetHashAlgorithm</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="s">&quot;SHA-256&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">public</span> <span class="kt">byte</span><span class="p">[]</span> <span class="nf">Sign</span><span class="p">(</span><span class="kt">byte</span><span class="p">[]</span> <span class="n">message</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="kt">var</span> <span class="n">hasher</span> <span class="p">=</span> <span class="k">new</span> <span class="n">SHA256CryptoServiceProvider</span><span class="p">();</span>
</span><span class='line'>        <span class="kt">var</span> <span class="n">digest</span> <span class="p">=</span> <span class="n">hasher</span><span class="p">.</span><span class="n">ComputeHash</span><span class="p">(</span><span class="n">message</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">return</span> <span class="n">keyClient</span>
</span><span class='line'>            <span class="p">.</span><span class="n">SignAsync</span><span class="p">(</span>
</span><span class='line'>                <span class="n">keyIdentifier</span><span class="p">,</span>
</span><span class='line'>                <span class="n">Microsoft</span><span class="p">.</span><span class="n">Azure</span><span class="p">.</span><span class="n">KeyVault</span><span class="p">.</span><span class="n">WebKey</span><span class="p">.</span><span class="n">JsonWebKeySignatureAlgorithm</span><span class="p">.</span><span class="n">RS256</span><span class="p">,</span>
</span><span class='line'>                <span class="n">digest</span><span class="p">)</span>
</span><span class='line'>            <span class="p">.</span><span class="n">Result</span><span class="p">.</span><span class="n">Result</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>KeyVaultSignature uses the key vault library to connect to the vault and use the specified key to sign the passed in PDF bytes. Since the key is the private part of the certificate, it will be validated by the public key. Below code shows how to use the KeyVaultSignature in the signing process.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">private</span> <span class="k">static</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">SignPdfWithNonExportableCertificateInKeyVault</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="kt">var</span> <span class="n">client</span> <span class="p">=</span> <span class="n">GetKeyVaultClient</span><span class="p">();</span>
</span><span class='line'>    <span class="kt">var</span> <span class="n">exportableSecretIdentifier</span> <span class="p">=</span> <span class="s">&quot;https://vaultfromcode.vault.azure.net:443/secrets/TestCertificateNE&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="kt">var</span> <span class="n">certificate</span> <span class="p">=</span> <span class="k">await</span> <span class="n">GetCertificateKeyVault</span><span class="p">(</span><span class="n">exportableSecretIdentifier</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="kt">var</span> <span class="n">keyIdentifier</span> <span class="p">=</span> <span class="s">&quot;https://vaultfromcode.vault.azure.net:443/keys/TestCertificateNE/65d27605fdf74eb2a3f807827cd756e1&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="kt">var</span> <span class="n">externalSignature</span> <span class="p">=</span> <span class="k">new</span> <span class="n">KeyVaultSignature</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">keyIdentifier</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">SignPdf</span><span class="p">(</span><span class="n">certificate</span><span class="p">,</span> <span class="n">externalSignature</span><span class="p">,</span> <span class="s">&quot;Non Exportable Key Vault.pdf&quot;</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Once you install and trust the public portion of the certificates, you can see the green tick, indicating that the PDF is verified and signed.</p>

<p><img src="/images/pdf_signed.png" alt="Signed PDF" /></p>

<p>The sample code for all three scenarios is available <a href="https://github.com/rahulpnath/Blog/tree/master/PDFSign">here</a>. I have used ClientId/Secret to authenticate with Key Vault for the sample code. If you are using this in a production environment, I will recommend using <a href="http://www.rahulpnath.com/blog/authenticating-a-client-application-with-azure-key-vault/">certificate to authenticate with Key Vault</a>. iText supports creating PDF stamps and more features in the signing process, which is well documented. Hope this helps you to secure your PDF files.</p>
</div>
  
  


        </article>
      
      
        <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
          
  <header class="page-header">
    
      <p class="meta text-muted text-capitalize">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2017-07-13T00:00:00+00:00"  data-updated="true" itemprop="datePublished dateCreated">Jul 13<sup>th</sup>, 2017</time>
        

<span class="glyphicon glyphicon-tags"></span>&nbsp; Posted in&nbsp; 
<span class="categories">
  
    <a class='category' href='/blog/category/tipow/'>tipow</a>
  
</span>


        
      </p>
    
    
      <h1 class="entry-title" itemprop="name headline"><a href="/blog/beyond-compare-compare-files-quick-and-easy/" itemprop="url">Tip of the Week: Beyond Compare - Compare Files Quick and Easy</a></h1>
    
  </header>


  <div class="entry-content clearfix" itemprop="articleBody description"><p>Merging conflicts can be a pain when working in large teams and code bases change fast. Every time you sync with the main code base you need to make sure that you integrate the updates with your work in progress. It&rsquo;s great when the changes get automatically merged by the source control systems. But when things need to be manually merged is where a good tool can be of help.</p>

<p><img src="/images/beyond_compare.png" class="center" alt="Beyond Compare"></p>

<blockquote><p><em><a href="http://www.scootersoftware.com/index.php">Beyond Compare</a> allows you to quickly and easily compare your files and folders.  By using simple, powerful commands, you can focus on the differences you&rsquo;re interested in and ignore those you&rsquo;re not.  You can then merge the changes, synchronize your files, and generate reports for your records.</em></p></blockquote>

<p>The <a href="http://www.scootersoftware.com/features.php?zz=features_multifaceted">Text Compare</a> viewer is the one that I use most frequently to compare or merge different versions of code. Beyond Compare makes it easy to spot the code differences and gives the capability to copy the code from one version to another. One can also copy portions of changes and merge just that instead of all the changes. The 3-Way Text Merge feature is also useful, especially when you are using Git.</p>

<p>Beyond Compare has a Standard and a Pro Edition with a lot of <a href="http://www.scootersoftware.com/features.php?zz=features_list">features</a>. I have the Pro Edition license for Beyond Compare, thanks to <a href="http://www.rahulpnath.com/blog/finding-a-job-abroad/">Readify</a> for the Software allowance that you get every year.</p>

<p>Beyond Compare is one of the <a href="http://www.rahulpnath.com/blog/tools-that-I-use/">tools that I use almost daily</a>. Check it out if you have not already.</p>
</div>
  
  


        </article>
      
    </div>

    <ul class="pager">
      
        <li class="previous"><a href="/blog/page/6">&larr;&nbsp;Older</a></li>
      
      <li><a href="/blog/archives">Blog Archives</a></li>
      
        <li class="next"><a href="/blog/page/4">Newer&nbsp;&rarr;</a></li>
      
    </ul>
  </div>

  
    <aside class="sidebar col-md-3">
      
        <section class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">Recent Posts</h3>
  </div>
  
  <div id="recent_posts" class="list-group">
    
    <a class="list-group-item " href="/blog/azure-ad-custom-attributes-and-optional-claims-from-an-asp-dot-net-application/">Azure AD Custom Attributes and Optional Claims from an ASP.Net Application</a>
    
    <a class="list-group-item " href="/blog/setting-up-dbup-in-azure-pipelines/">Setting up DbUp in Azure Pipelines</a>
    
    <a class="list-group-item " href="/blog/azure-pipelines-how-to-find-remaining-build-minutes/">Tip of the Week: Azure Pipelines - How to Find Remaining Free Build Minutes?</a>
    
    <a class="list-group-item " href="/blog/working-effectively-under-constraints/">Working Effectively Under Constraints</a>
    
    <a class="list-group-item " href="/blog/subresource-integrity-sri/">Subresource Integrity (SRI)</a>
    
  </div>
</section>
<section>
    <a href="https://msdn.microsoft.com/en-us/magazine/mt149362?author=Rahul+Nath">
        <img src="/images/msdn_magazine_aside.jpg" alt="MSDN Magazine Author">
    </a>
</section>



<section class="googleplus googleplus-hidden panel panel-default">
  <div class="panel-body">
    <h1>
      <a href="https://plus.google.com/+RahulNath?rel=author">
        <img src="https://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
        Google+
      </a>
    </h1>
  </div>
</section>



      
    </aside>
  
</div>

        </div>
      </div>
    </div>
    <footer role="contentinfo"><div class="container">
    <p class="text-muted credits">
  Copyright &copy; 2018 - Rahul Nath<br>
  <small>
      <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>,
      <span class="credit">customized with <a href="https://github.com/kAworu/octostrap3">octostrap3</a></span>.
  </small>
</p>

</div>
</footer>
    

<script type="text/javascript" nonce="ZGlzcXVzc2NyaXB0">
      var disqus_shortname = 'rahulpnath';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script nonce="ZmFjZWJvb2tsaWtl">(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>





  <script type="text/javascript" nonce="dHdlZXRidXR0b24=">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>


<script 
    src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.2.0/js/bootstrap.min.js" 
    integrity="sha256-JMwpUzWY+WKCPEIpvCgEh2RqJ6QqlSV8Md4bmxjzcQ8="
    crossorigin="anonymous">
</script>
<script 
    src="/javascripts/modernizr-2.0.js" 
    integrity="sha256-hME7nDofAgLynuLg6DATEk67QUTY7HetpZJjZ+HNZek="
    crossorigin="anonymous">
</script>

  </body>
</html>
