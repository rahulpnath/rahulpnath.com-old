<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
  <meta charset="utf-8">
  <title>HTTP Content Security Policy (CSP) - Rahul Nath</title>
  <meta name="author" content="Rahul Nath">

  
<meta name="description" content="Prevent execution of malicious content in the context of your website." />


<meta name="keywords" content=".NET, programming, rahul nath, rahul, C#" />

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://rahulpnath.com/blog/http-content-security-policy-csp">
  
<!-- Favicon -->
  <link href="/favicon.png" type="image/png" rel="icon">
  <link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png">
  <link rel="icon" type="image/png" href="/favicon-196x196.png" sizes="196x196">
  <link rel="icon" type="image/png" href="/favicon-160x160.png" sizes="160x160">
  <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
  <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
  <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="msapplication-TileImage" content="/mstile-144x144.png">
<!-- End Favicon -->
  <link href="http://feeds2.feedburner.com/rahulpnath" rel="alternate" title="Rahul Nath" type="application/atom+xml">

  <!-- Social media content metadata -->


<meta property="fb:admins" content="774780093" />
<meta property="og:title" content="HTTP Content Security Policy (CSP)" />
<meta property="og:site_name" content="Rahul Nath" />
<meta property="og:url" content="http://rahulpnath.com/blog/http-content-security-policy-csp/" />
<meta property="og:description" content="Prevent execution of malicious content in the context of your website." />
<meta property="og:author" content="https://www.facebook.com/774780093" />
<meta property="og:image" content="http://www.rahulpnath.com/images/content-security-policy.png" />


<meta property="twitter:card" content="summary_large_image" />
<meta property="twitter:site" content="rahulpnath" />
<meta property="twitter:url" content="http://rahulpnath.com/blog/http-content-security-policy-csp" />
<meta property="twitter:title" content="HTTP Content Security Policy (CSP)" />
<meta property="twitter:description" content="Prevent execution of malicious content in the context of your website." />
<meta property="twitter:creator" content="rahulpnath" />
<meta property="twitter:image:src" content="http://www.rahulpnath.com/images/content-security-policy.png" />

<script src="/javascripts/libs/jquery/jquery-2.0.3.min.js"></script>

<link href="/assets/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet" type="text/css">
<link href="/assets/bootstrap/dist/css/bootstrap-theme.min.css" rel="stylesheet" type="text/css">


  
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">

  
   <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-43172163-1', 'auto');
    ga('send', 'pageview');

  </script>


</head>

  <body   >
    <div id="wrap">
      <header role="banner">
        <nav class="navbar navbar-default" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Rahul Nath</a>
        </div>

        <div class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
                <li class="active">
                    <a rel="index" href="/">Blog</a>
                </li>
                <li >
                    <a href="/blog/archives">Archives</a>
                </li>
                <li >
                    <a href="/apps">Apps</a>
                </li>
                <li >
                    <a href="/about">About</a>
                </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a class="subscribe-rss" href="http://feeds2.feedburner.com/rahulpnath" title="subscribe via RSS">
                        <span class="visible-xs">RSS</span>
                        <img class="hidden-xs" src="/images/rss.png" alt="RSS">
                    </a>
                </li>
                
            </ul>
            
                <form class="search navbar-form navbar-right" action="http://google.com/cse" method="GET">
                    <input type="hidden" name="cx" value="013909293779229500224:v37rx6hsidk" />
                    <input name="ie" type="hidden" value="UTF-8">
                    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
                </form>
            
        </div>
    </div>
</nav>


      </header>
      <div id="main" class="container">
        <div id="content">
          <div class="row">
  <div class="page-content col-md-9" itemscope itemtype="http://schema.org/Blog">
    <meta itemprop="name" content="Rahul Nath" />
    <meta itemprop="description" content="Rahul Nath is a programmer, blogger, speaker and enjoys running. Blogs are usually technical or about life in general." />
    <meta itemprop="url" content="http://rahulpnath.com" />
    <article class="hentry" role="article" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
      
  <header class="page-header">
    
      <p class="meta text-muted text-capitalize">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2018-07-24T00:00:00+00:00"  data-updated="true" itemprop="datePublished dateCreated">Jul 24<sup>th</sup>, 2018</time>
        

<span class="glyphicon glyphicon-tags"></span>&nbsp; Posted in&nbsp; 
<span class="categories">
  
    <a class='category' href='/blog/category/security/'>security</a>
  
</span>


        
      </p>
    
    
    <h1 class="entry-title" itemprop="name headline">
        HTTP Content Security Policy (CSP)
        
    </h1>
    
  </header>


<div class="entry-content clearfix" itemprop="articleBody"><p><em>This article is part of a series of articles - <a href="/blog/ok-i-have-got-https-what-next/">Ok I have got HTTPS! What Next?</a>. In this post, we explore how to use HSTS security header and the issues it solves.</em></p>

<p>Content Security Policy (CSP) is a security response header or a <meta> element that instructs the browser, sources of information that it should trust for our website. A browser that supports CSP&rsquo;s then treats this list specified as a whitelist and only allows resources to be loaded only for those sources. CSP&rsquo;s allow you to specify source locations for a variety of resource types which are referred to as <a href="https://developer.mozilla.org/en-US/docs/Glossary/Fetch_directive">fetch directives</a>(e.g. _script-src, img-src,style-src* etc).</p>

<p><img src="/images/content-security-policy.png" alt="Content Security Policy"  class="center" /></p>

<p>CSP is an added layer of security that helps to detect and mitigate certain types of attacks, including Cross Site Scripting (XSS) and data injection attacks. These attacks are used for everything from data theft to site defacement or distribution of malware.</p>

<figure class='code'><figcaption><span>Example</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>Content-Security-Policy: default-src &#39;self&#39; *.rahulpnath.com
</span></code></pre></td></tr></table></div></figure>


<h3>Setting CSP Headers</h3>

<p><strong>Web Server Configuration</strong></p>

<p>CSP&rsquo;s can be set via the configuration file of your web server host if you want to specify it as part of the header. In my case I use Azure Web App, so all I need to do is add in a web.config file to my root with the header values. Below is an example which specified CSP headers (including Report Only) and <a href="/blog/http-strict-transport-security-sts-or-hsts/">STS headers</a>.</p>

<figure class='code'><figcaption><span>Web.config Sample</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;configuration&gt;</span>
</span><span class='line'>  <span class="nt">&lt;system.webServer&gt;</span>
</span><span class='line'>    <span class="nt">&lt;httpProtocol&gt;</span>
</span><span class='line'>      <span class="nt">&lt;customHeaders&gt;</span>
</span><span class='line'>        <span class="nt">&lt;add</span> <span class="na">name=</span><span class="s">&quot;Content-Security-Policy&quot;</span> <span class="na">value=</span><span class="s">&quot;upgrade-insecure-requests;&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>        <span class="nt">&lt;add</span> <span class="na">name=</span><span class="s">&quot;Content-Security-Policy-Report-Only&quot;</span> <span class="na">value=</span><span class="s">&quot;default-src &#39;none&#39;;report-uri https://rahulpnath.report-uri.com/r/d/csp/reportOnly&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>        <span class="nt">&lt;add</span> <span class="na">name=</span><span class="s">&quot;Strict-Transport-Security&quot;</span> <span class="na">value=</span><span class="s">&quot;max-age=31536000; includeSubDomains; preload&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/customHeaders&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/httpProtocol&gt;</span>
</span><span class='line'>    ...
</span></code></pre></td></tr></table></div></figure>


<p><strong>Using Fiddler</strong></p>

<p>However if all you want is to play around with the CSP header and don&rsquo;t have access to your Web server or the configuration file, you can still test these headers. You can inject in the headers into the response using a <a href="blog/fiddler-free-web-debugging-proxy/">Web Proxy like Fiddler</a></p>

<p>To modify the request/response in-flight you can use one of the most powerful feature in Fiddler - <a href="https://www.telerik.com/blogs/understanding-fiddlerscript">Fiddler Script</a></p>

<blockquote><p>Fiddler Script allows you to enhance Fiddler’s UI, add new features, and modify requests and responses “on the fly” to introduce any behavior you’d like.</p></blockquote>

<p>Using the below script, we can inject &lsquo;Content-Security-Policy&rsquo; header whenever the request matches a specific criteria.</p>

<p><img src="/images/https_csp_fiddler_script.png" alt="Fiddler Script to update CSP"  class="center" /></p>

<figure class='code'><figcaption><span>Fiddler Script - Inject CSP Header</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="k">if</span> <span class="p">(</span><span class="nx">oSession</span><span class="p">.</span><span class="nx">HostnameIs</span><span class="p">(</span><span class="s2">&quot;rahulpnath.com&quot;</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">oSession</span><span class="p">.</span><span class="nx">oResponse</span><span class="p">.</span><span class="nx">headers</span><span class="p">[</span><span class="s2">&quot;Content-Security-Policy&quot;</span><span class="p">]</span> <span class="o">=</span>
</span><span class='line'>    <span class="s2">&quot;default-src &#39;none&#39;; img-src &#39;self&#39;;script-src &#39;self&#39;;style-src &#39;self&#39;&quot;</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>By injecting these headers, we can play around with the CSP headers for the webiste without affecting other users. Once you have the CSP rules that cater to your site you can commit this to the actual website. Even with all the CSP headers set, you can additionally set the <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/report-to">report-to</a> (or deprecated <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/report-uri">report-uri</a>) directive on the policy to capture any policies that you may have missed.</p>

<h3>Content-Security-Policy-Report-Only</h3>

<p>The <em>Content-Security-Policy_Report-Only</em> header allows to test the header settings without any impact and also to capture any CSP headers that you might have missed on your website. The browser uses this for reporting purposes only and does not enforce the policies. We can specify a report endpoint to which the browser will send any CSP violations as a JSON object.</p>

<p>Below is an example of a CSP violation POST request send from the browser to the report URL that I had specified for this blog. I am using an endpoint from the <a href="https://report-uri.com/">Report URI</a> service (more on this later)</p>

<figure class='code'><figcaption><span>Example</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='json'><span class='line'><span class="err">POST</span> <span class="err">https://rahulpnath.report-uri.com/r/d/csp/reportOnly</span> <span class="err">HTTP/</span><span class="mf">1.1</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="nt">&quot;csp-report&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'>        <span class="nt">&quot;document-uri&quot;</span><span class="p">:</span> <span class="s2">&quot;https://www.rahulpnath.com/&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="nt">&quot;referrer&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="nt">&quot;violated-directive&quot;</span><span class="p">:</span> <span class="s2">&quot;img-src&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="nt">&quot;effective-directive&quot;</span><span class="p">:</span> <span class="s2">&quot;img-src&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="nt">&quot;original-policy&quot;</span><span class="p">:</span> <span class="s2">&quot;default-src &#39;none&#39;;report-uri https://rahulpnath.report-uri.com/r/d/csp/reportOnly&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="nt">&quot;disposition&quot;</span><span class="p">:</span> <span class="s2">&quot;report&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="nt">&quot;blocked-uri&quot;</span><span class="p">:</span> <span class="s2">&quot;https://www.rahulpnath.com/apple-touch-icon-120x120.png&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="nt">&quot;line-number&quot;</span><span class="p">:</span> <span class="mi">29</span><span class="p">,</span>
</span><span class='line'>        <span class="nt">&quot;source-file&quot;</span><span class="p">:</span> <span class="s2">&quot;https://www.rahulpnath.com/&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="nt">&quot;status-code&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span class='line'>        <span class="nt">&quot;script-sample&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Generating CSP Policies</h3>

<p>Coming up with the CSP policies for your site can be a bit tricky as there are a lot of options and directives involved. Your site might also be pulling in dependencies from a variety of sources. Setting CSP policies is also an excellent time to review your application dependencies and manage them correctly. For e.g., if you have a javascript file from an untrusted source, etc. There are a few ways by which you can go about generating CSP policies. Below are two ways I found useful and easy to get started.</p>

<p><strong>Using Fiddler</strong></p>

<p>The <a href="https://github.com/david-risney/CSP-Fiddler-Extension">CSP Fiddler Extension</a> is a Fiddler extension that helps you produce a strong CSP for a web page (or website). Install the extension and with Fiddler running navigate to your web pages using a browser that supports CSP.</p>

<blockquote><p><em>The extension adds mock Content-Security-Policy-Report-Only headers to servers&#8217; responses and uses the report-uri <a href="https://fiddlercsp.deletethis.net/unsafe-inline.">https://fiddlercsp.deletethis.net/unsafe-inline.</a> The extension then listens to the specified report-uri and generates a CSP based on the gathered information</em></p></blockquote>

<p><img src="/images/https_csp_fiddler_rule_collector.png" class="center" alt="Fiddler CSP Rule Collector" /></p>

<p><strong>Using Report URI</strong></p>

<p><a href="https://report-uri.com/">ReportURI</a> is a real-time security reporting tool which can be used to collect various metrics about your website. One of the features it provides is giving a nice little wizard interface for creating your CSP headers. <a href="https://report-uri.com/#prices">Pricing</a> is usage based and provides the first 10000 reports of the month free (which is what I am using for this blog).</p>

<p>ReportURI gives a dashboard summarizing the various stats of your site and also provides features to explore these in detail.</p>

<p><img src="/images/csp_report_uri_dashboard.png" alt="Report Uri Dashboard" class="center" /></p>

<p>One of the cool features is the <a href="https://scotthelme.co.uk/report-uri-csp-wizard/">CSP Wizard</a> which as the name suggests, provides a wizard-like UI to build out CSP&rsquo;s for the site. The websites need to be configured to report CSP errors to a specific endpoint on your ReportURI endpoint (as shown below). The header value can be set either on CSP header or the Report Only header.</p>

<blockquote><p><em>You can find your report URL from the Setup tab on Report URI. Make sure you use the URL under the options Report Type: CSP and Report Disposition: <strong>Wizard</strong></em></p></blockquote>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>Content-Security-Policy-Report-Only: default-src &#39;none&#39;;report-uri https://&lt;subdomain&gt;.report-uri.com/r/d/csp/wizard
</span></code></pre></td></tr></table></div></figure>


<p>Once all configured and reports start coming in you can use the Wizard to pick and choose what sources you need to whitelist for your website. You might see a lot of unwanted sources and entries in the wizard as it just reflects what is reported to it. You need to filter it out manually and build the list.</p>

<p>Once you have the CSP&rsquo;s set you can check out if your site does the Harlem Shake by pressing F12 and running the below script. Though this is not any sort of test, it is a fun exercise to do.</p>

<div class="alert alert-warning">
<b>Copy pasting scripts from unknown source is not at all recommended and is one of the most powerful ways that an attacker can get access to your account.</b> Having a well defined CSP prevents such script attacks as well on your sites. Don&#8217;t be suprised if your banking site also shakes to the tune of the script below. 
</div>


<p><em>That said do give the below script a try! I did go through the code pasted below and it is not malicious. All it does modify your dom elements and plays a music. The original source is available below but I do not control it and it could have change since the time of writing.</em></p>

<figure class='code'><figcaption><span>Harlem Shake - F12 on Browser tab and run below script (Check your Volume)</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c1">//Source: http://pastebin.com/aJna4paJ</span>
</span><span class='line'><span class="nx">javascript</span><span class="o">:</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span><span class="kd">function</span> <span class="nx">c</span><span class="p">(){</span><span class="kd">var</span> <span class="nx">e</span><span class="o">=</span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;link&quot;</span><span class="p">);</span><span class="nx">e</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span><span class="s2">&quot;text/css&quot;</span><span class="p">);</span>
</span><span class='line'><span class="nx">e</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s2">&quot;rel&quot;</span><span class="p">,</span><span class="s2">&quot;stylesheet&quot;</span><span class="p">);</span><span class="nx">e</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s2">&quot;href&quot;</span><span class="p">,</span><span class="nx">f</span><span class="p">);</span><span class="nx">e</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s2">&quot;class&quot;</span><span class="p">,</span><span class="nx">l</span><span class="p">);</span>
</span><span class='line'><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">e</span><span class="p">)}</span><span class="kd">function</span> <span class="nx">h</span><span class="p">(){</span><span class="kd">var</span> <span class="nx">e</span><span class="o">=</span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByClassName</span><span class="p">(</span><span class="nx">l</span><span class="p">);</span>
</span><span class='line'><span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">t</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">t</span><span class="o">&lt;</span><span class="nx">e</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">t</span><span class="o">++</span><span class="p">){</span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="nx">e</span><span class="p">[</span><span class="nx">t</span><span class="p">])}}</span><span class="kd">function</span> <span class="nx">p</span><span class="p">(){</span><span class="kd">var</span> <span class="nx">e</span><span class="o">=</span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;div&quot;</span><span class="p">);</span>
</span><span class='line'><span class="nx">e</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s2">&quot;class&quot;</span><span class="p">,</span><span class="nx">a</span><span class="p">);</span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span><span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="nx">e</span><span class="p">)},</span><span class="mi">100</span><span class="p">)}</span>
</span><span class='line'><span class="kd">function</span> <span class="nx">d</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span><span class="k">return</span><span class="p">{</span><span class="nx">height</span><span class="o">:</span><span class="nx">e</span><span class="p">.</span><span class="nx">offsetHeight</span><span class="p">,</span><span class="nx">width</span><span class="o">:</span><span class="nx">e</span><span class="p">.</span><span class="nx">offsetWidth</span><span class="p">}}</span><span class="kd">function</span> <span class="nx">v</span><span class="p">(</span><span class="nx">i</span><span class="p">){</span><span class="kd">var</span> <span class="nx">s</span><span class="o">=</span><span class="nx">d</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span>
</span><span class='line'><span class="k">return</span> <span class="nx">s</span><span class="p">.</span><span class="nx">height</span><span class="o">&gt;</span><span class="nx">e</span><span class="o">&amp;&amp;</span><span class="nx">s</span><span class="p">.</span><span class="nx">height</span><span class="o">&lt;</span><span class="nx">n</span><span class="o">&amp;&amp;</span><span class="nx">s</span><span class="p">.</span><span class="nx">width</span><span class="o">&gt;</span><span class="nx">t</span><span class="o">&amp;&amp;</span><span class="nx">s</span><span class="p">.</span><span class="nx">width</span><span class="o">&lt;</span><span class="nx">r</span><span class="p">}</span><span class="kd">function</span> <span class="nx">m</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span><span class="kd">var</span> <span class="nx">t</span><span class="o">=</span><span class="nx">e</span><span class="p">;</span><span class="kd">var</span> <span class="nx">n</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="k">while</span><span class="p">(</span><span class="o">!!</span><span class="nx">t</span><span class="p">){</span><span class="nx">n</span><span class="o">+=</span><span class="nx">t</span><span class="p">.</span><span class="nx">offsetTop</span><span class="p">;</span><span class="nx">t</span><span class="o">=</span><span class="nx">t</span><span class="p">.</span><span class="nx">offsetParent</span><span class="p">}</span><span class="k">return</span> <span class="nx">n</span><span class="p">}</span><span class="kd">function</span> <span class="nx">g</span><span class="p">(){</span><span class="kd">var</span> <span class="nx">e</span><span class="o">=</span><span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">;</span>
</span><span class='line'><span class="k">if</span><span class="p">(</span><span class="o">!!</span><span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span><span class="p">){</span><span class="k">return</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerHeight</span><span class="p">}</span><span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">e</span><span class="o">&amp;&amp;!</span><span class="nb">isNaN</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">clientHeight</span><span class="p">)){</span><span class="k">return</span> <span class="nx">e</span><span class="p">.</span><span class="nx">clientHeight</span><span class="p">}</span><span class="k">return</span> <span class="mi">0</span><span class="p">}</span>
</span><span class='line'><span class="kd">function</span> <span class="nx">y</span><span class="p">(){</span><span class="k">if</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">pageYOffset</span><span class="p">){</span><span class="k">return</span> <span class="nb">window</span><span class="p">.</span><span class="nx">pageYOffset</span><span class="p">}</span><span class="k">return</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">.</span><span class="nx">scrollTop</span><span class="p">,</span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">scrollTop</span><span class="p">)}</span>
</span><span class='line'><span class="kd">function</span> <span class="nx">E</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span><span class="kd">var</span> <span class="nx">t</span><span class="o">=</span><span class="nx">m</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span><span class="k">return</span> <span class="nx">t</span><span class="o">&gt;=</span><span class="nx">w</span><span class="o">&amp;&amp;</span><span class="nx">t</span><span class="o">&lt;=</span><span class="nx">b</span><span class="o">+</span><span class="nx">w</span><span class="p">}</span><span class="kd">function</span> <span class="nx">S</span><span class="p">(){</span><span class="kd">var</span> <span class="nx">e</span><span class="o">=</span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;audio&quot;</span><span class="p">);</span><span class="nx">e</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s2">&quot;class&quot;</span><span class="p">,</span><span class="nx">l</span><span class="p">);</span>
</span><span class='line'><span class="nx">e</span><span class="p">.</span><span class="nx">src</span><span class="o">=</span><span class="nx">i</span><span class="p">;</span><span class="nx">e</span><span class="p">.</span><span class="nx">loop</span><span class="o">=</span><span class="kc">false</span><span class="p">;</span><span class="nx">e</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;canplay&quot;</span><span class="p">,</span><span class="kd">function</span><span class="p">(){</span><span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span><span class="nx">x</span><span class="p">(</span><span class="nx">k</span><span class="p">)},</span><span class="mi">500</span><span class="p">);</span>
</span><span class='line'><span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span><span class="nx">N</span><span class="p">();</span><span class="nx">p</span><span class="p">();</span><span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">e</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">e</span><span class="o">&lt;</span><span class="nx">O</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">e</span><span class="o">++</span><span class="p">){</span><span class="nx">T</span><span class="p">(</span><span class="nx">O</span><span class="p">[</span><span class="nx">e</span><span class="p">])}},</span><span class="mi">15500</span><span class="p">)},</span><span class="kc">true</span><span class="p">);</span>
</span><span class='line'><span class="nx">e</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;ended&quot;</span><span class="p">,</span><span class="kd">function</span><span class="p">(){</span><span class="nx">N</span><span class="p">();</span><span class="nx">h</span><span class="p">()},</span><span class="kc">true</span><span class="p">);</span>
</span><span class='line'><span class="nx">e</span><span class="p">.</span><span class="nx">innerHTML</span><span class="o">=</span><span class="s2">&quot; &lt;p&gt;If you are reading this, it is because your browser does not support the audio element. We recommend that you get a new browser.&lt;/p&gt; &lt;p&gt;&quot;</span><span class="p">;</span>
</span><span class='line'><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span><span class="nx">e</span><span class="p">.</span><span class="nx">play</span><span class="p">()}</span><span class="kd">function</span> <span class="nx">x</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span><span class="nx">e</span><span class="p">.</span><span class="nx">className</span><span class="o">+=</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="nx">s</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="nx">o</span><span class="p">}</span>
</span><span class='line'><span class="kd">function</span> <span class="nx">T</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span><span class="nx">e</span><span class="p">.</span><span class="nx">className</span><span class="o">+=</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="nx">s</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="nx">u</span><span class="p">[</span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="o">*</span><span class="nx">u</span><span class="p">.</span><span class="nx">length</span><span class="p">)]}</span><span class="kd">function</span> <span class="nx">N</span><span class="p">(){</span><span class="kd">var</span> <span class="nx">e</span><span class="o">=</span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByClassName</span><span class="p">(</span><span class="nx">s</span><span class="p">);</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">t</span><span class="o">=</span><span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s2">&quot;\\b&quot;</span><span class="o">+</span><span class="nx">s</span><span class="o">+</span><span class="s2">&quot;\\b&quot;</span><span class="p">);</span><span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">n</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">n</span><span class="o">&lt;</span><span class="nx">e</span><span class="p">.</span><span class="nx">length</span><span class="p">;){</span><span class="nx">e</span><span class="p">[</span><span class="nx">n</span><span class="p">].</span><span class="nx">className</span><span class="o">=</span><span class="nx">e</span><span class="p">[</span><span class="nx">n</span><span class="p">].</span><span class="nx">className</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)}}</span><span class="kd">var</span> <span class="nx">e</span><span class="o">=</span><span class="mi">30</span><span class="p">;</span><span class="kd">var</span> <span class="nx">t</span><span class="o">=</span><span class="mi">30</span><span class="p">;</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">n</span><span class="o">=</span><span class="mi">350</span><span class="p">;</span><span class="kd">var</span> <span class="nx">r</span><span class="o">=</span><span class="mi">350</span><span class="p">;</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="s2">&quot;//s3.amazonaws.com/moovweb-marketing/playground/harlem-shake.mp3&quot;</span><span class="p">;</span><span class="kd">var</span> <span class="nx">s</span><span class="o">=</span><span class="s2">&quot;mw-harlem_shake_me&quot;</span><span class="p">;</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">o</span><span class="o">=</span><span class="s2">&quot;im_first&quot;</span><span class="p">;</span><span class="kd">var</span> <span class="nx">u</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;im_drunk&quot;</span><span class="p">,</span><span class="s2">&quot;im_baked&quot;</span><span class="p">,</span><span class="s2">&quot;im_trippin&quot;</span><span class="p">,</span><span class="s2">&quot;im_blown&quot;</span><span class="p">];</span><span class="kd">var</span> <span class="nx">a</span><span class="o">=</span><span class="s2">&quot;mw-strobe_light&quot;</span><span class="p">;</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">f</span><span class="o">=</span><span class="s2">&quot;//s3.amazonaws.com/moovweb-marketing/playground/harlem-shake-style.css&quot;</span><span class="p">;</span><span class="kd">var</span> <span class="nx">l</span><span class="o">=</span><span class="s2">&quot;mw_added_css&quot;</span><span class="p">;</span><span class="kd">var</span> <span class="nx">b</span><span class="o">=</span><span class="nx">g</span><span class="p">();</span><span class="kd">var</span> <span class="nx">w</span><span class="o">=</span><span class="nx">y</span><span class="p">();</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">C</span><span class="o">=</span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">);</span><span class="kd">var</span> <span class="nx">k</span><span class="o">=</span><span class="kc">null</span><span class="p">;</span><span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">L</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">L</span><span class="o">&lt;</span><span class="nx">C</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">L</span><span class="o">++</span><span class="p">){</span><span class="kd">var</span> <span class="nx">A</span><span class="o">=</span><span class="nx">C</span><span class="p">[</span><span class="nx">L</span><span class="p">];</span><span class="k">if</span><span class="p">(</span><span class="nx">v</span><span class="p">(</span><span class="nx">A</span><span class="p">)){</span><span class="k">if</span><span class="p">(</span><span class="nx">E</span><span class="p">(</span><span class="nx">A</span><span class="p">)){</span><span class="nx">k</span><span class="o">=</span><span class="nx">A</span><span class="p">;</span><span class="k">break</span><span class="p">}}}</span>
</span><span class='line'><span class="k">if</span><span class="p">(</span><span class="nx">A</span><span class="o">===</span><span class="kc">null</span><span class="p">){</span><span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="s2">&quot;Could not find a node of the right size. Please try a different page.&quot;</span><span class="p">);</span><span class="k">return</span><span class="p">}</span><span class="nx">c</span><span class="p">();</span><span class="nx">S</span><span class="p">();</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">O</span><span class="o">=</span><span class="p">[];</span><span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">L</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">L</span><span class="o">&lt;</span><span class="nx">C</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">L</span><span class="o">++</span><span class="p">){</span><span class="kd">var</span> <span class="nx">A</span><span class="o">=</span><span class="nx">C</span><span class="p">[</span><span class="nx">L</span><span class="p">];</span><span class="k">if</span><span class="p">(</span><span class="nx">v</span><span class="p">(</span><span class="nx">A</span><span class="p">)){</span><span class="nx">O</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">A</span><span class="p">)}}})()</span>
</span></code></pre></td></tr></table></div></figure>


<p>I am still playing around with the CSP headers for this blog and currently testing it out using the ReportOnly header along with ReportURI. Hope this helps you to start putting the correct CSP headers for your site as well!</p>
</div>


      <footer>
        
  


<div>
	<h4>About Rahul</h4>
	<img src="/images/rahul_p_nath.jpeg" style="border:0;vertical-align: baseline;" class="left" alt="Rahul Nath"> 
	<span>
		Rahul Nath is a technology consultant, father, speaker and <del>Microsoft</del> Readify employee. He is a former MCCA and enjoys photography and cycling.
	</span>
	<br />
	<br />
	<a href="https://twitter.com/rahulpnath" rel="me"><img style="border:0;vertical-align: baseline;" alt="Twitter" src="/images/icon-twitter.png"></a>
	<a href="https://www.facebook.com/rahulpnath" rel="me"><img style="border:0;vertical-align: baseline;" alt="Facebook" src="/images/icon-fb.png"></a>
	<a href="http://feeds2.feedburner.com/rahulpnath" rel="me"><img style="border:0;vertical-align: baseline;" alt="Feed" src="/images/icon-rss.png"></a>
</div>
<p style="clear:left;"></p>


        
<div>
<br>
  <h4>You might also like</h4>
  <div class="entry-content">
  <ul>
  
    <li>
    	<p>
      		<a href="/blog/http-strict-transport-security-sts-or-hsts/">HTTP Strict Transport Security (STS or HSTS)</a>
  		</p>
    </li>
  
    <li>
    	<p>
      		<a href="/blog/ok-i-have-got-https-what-next/">Ok I Have Got HTTPS! What Next?</a>
  		</p>
    </li>
  
    <li>
    	<p>
      		<a href="/blog/check-if-you-have-been-hacked/">Tip of the Week: Check If You Have Been Hacked!</a>
  		</p>
    </li>
  
    <li>
    	<p>
      		<a href="/blog/ndc-security-2018-overview-and-key-takeaways/">NDC Security 2018 - Overview and Key Takeaways</a>
  		</p>
    </li>
  
  </ul>
</div>
<br>
</div>

        
          <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://rahulpnath.com/blog/http-content-security-policy-csp/" data-via="rahulpnath" data-counturl="http://rahulpnath.com/blog/http-content-security-policy-csp/" >Tweet</a>
  
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

        
        
          <ul class="meta text-muted pager">
            
            <li class="previous"><a href="/blog/http-strict-transport-security-sts-or-hsts/" title="Previous Post: HTTP Strict Transport Security (STS or HSTS)">&laquo; HTTP Strict Transport Security (STS or HSTS)</a></li>
            
            
          </ul>
        
      </footer>
    </article>
    
      <section>
        <h1>Comments</h1>
        <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
      </section>
    
  </div>

  
  <aside class="sidebar col-md-3">
    
      
    
  </aside>
  
</div>

        </div>
      </div>
    </div>
    <footer role="contentinfo"><div class="container">
    <p class="text-muted credits">
  Copyright &copy; 2018 - Rahul Nath<br>
  <small>
      <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>,
      <span class="credit">customized with <a href="https://github.com/kAworu/octostrap3">octostrap3</a></span>.
  </small>
</p>

</div>
</footer>
    

<script type="text/javascript">
      var disqus_shortname = 'rahulpnath';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://rahulpnath.com/blog/http-content-security-policy-csp/';
        var disqus_url = 'http://rahulpnath.com/blog/http-content-security-policy-csp/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>





  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>


<script src="/assets/bootstrap/dist/js/bootstrap.min.js"></script>
<script src="/javascripts/modernizr-2.0.js"></script>


  </body>
</html>
